<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login - DB Security Bot</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
</head>
<body class="page-center">
  <div class="card login-card">
    <div class="brand">DB Security â€¢ WhatsApp</div>
    <p class="muted">Masukkan KEY untuk masuk. <strong>Admin</strong> punya hak tambah/hapus; <strong>User</strong> hanya tambah & lihat.</p>

    <label class="label">KEY</label>
    <input id="key" class="input" placeholder="Masukkan KEY (contoh: SkyPeler atau JanganRusuh)">

    <div style="display:flex;gap:.5rem;margin-top:12px;">
      <button id="btnLogin" class="btn primary">Login</button>
      <a href="/dashboard.html" class="btn ghost">Dashboard</a>
    </div>

    <div id="msg" class="msg"></div>

    <footer class="muted small">Format nomor input: mulai dengan <strong>62</strong> (contoh: 628123456789)</footer>
  </div>

  <script>
    document.getElementById('btnLogin').addEventListener('click', async () => {
      const key = document.getElementById('key').value.trim();
      if (!key) return showMsg('Masukkan key dulu', true);
      try {
        const res = await fetch('/key-login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ key })
        });
        const j = await res.json();
        if (!j.success) return showMsg(j.message || 'Gagal login', true);
        // simpan ke localStorage
        localStorage.setItem('db_key', key);
        localStorage.setItem('db_role', j.role);
        showMsg('Login sukses sebagai ' + j.role, false);
        setTimeout(()=> location.href = '/dashboard.html', 800);
      } catch (e) {
        showMsg('Kesalahan koneksi', true);
      }
    });

    function showMsg(t, err=false) {
      const el = document.getElementById('msg');
      el.textContent = t;
      el.style.color = err ? '#b91c1c' : '#064e3b';
    }
  </script>
</body>
</html>